
timestamps {

node () {

 wrap([$class: 'Xvfb']) {
	stage ('Application - Checkout') {
 	 checkout([$class: 'GitSCM', branches: [[name: '*/main']], doGenerateSubmoduleConfigurations: false, extensions: [], submoduleCfg: [], userRemoteConfigs: [[credentialsId: 'Jenkins-GitHub', url: 'https://github.com/preethiram4/mqtest.git']]]) 
	}
	stage ('Application - Build Process') {
sh label: '', script: '''#!/bin/bash
source /opt/IBM/ace-11.0.0.11/server/bin/mqsiprofile
/opt/IBM/ace-11.0.0.11/tools/mqsicreatebar -data . -b ${AppName}.bar -a $AppName'''
}
stage ('Application - Apply Bar Override') {
sh label: '', script: '''#!/bin/bash
source /opt/IBM/ace-11.0.0.11/server/bin/mqsiprofile
echo "Application Name " $AppName ${AppName}_${Environment}
mqsiapplybaroverride -b ${AppName}.bar -p ${AppName}/BarOverrides/${AppName}_${Environment}.properties -o ${AppName}_${BUILD_NUMBER}.bar -r'''
}
stage ('Application - Commit Bar File') {
sh label: '', script: '''#!/bin/bash
echo "Application Name " $AppName ${AppName}_{$BUILD_NUMBER}
zip ${AppName}_{$BUILD_NUMBER}.zip ${AppName}_${BUILD_NUMBER}.bar
zip /home/zilker/appdata/bar/${AppName}_${BUILD_NUMBER}.zip ${AppName}_${BUILD_NUMBER}.bar
chmod 777 /home/zilker/appdata/bar/${AppName}_${BUILD_NUMBER}.zip '''
}
stage('Update GIT') {
  
    script {
      catchError(buildResult: 'SUCCESS', stageResult: 'FAILURE') {
        withCredentials([usernamePassword(credentialsId: '61c81f80-8151-4899-aecd-80d576412f2e', passwordVariable: 'GIT_PASSWORD', usernameVariable: 'GIT_USERNAME')]) {
            def encodedPassword = URLEncoder.encode("$GIT_PASSWORD",'UTF-8')
            sh "git config user.email preethiram4@gmail.com"
            sh "git config user.name preethiram4"
			
			sh "git remote set-url origin https://github.com/preethiram4/mqtest.git"
			sh "git add . "
            sh "git commit -m 'Triggered Build: ${env.BUILD_NUMBER}'"
			sh "git push --set-upstream origin HEAD:main"
            
        }
      }
    }
  
}
    



}
cleanWs()
}
}